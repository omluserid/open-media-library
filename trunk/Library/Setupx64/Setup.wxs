<?xml version="1.0" encoding="UTF-8"?>

<!-- These variables define the Windows Installer product version, product code and upgrade code. They   -->
<!-- will be used later on in this file.                                                                 -->
<?define Property_ProductVersion = "2.1.3.0" ?>
<?define Property_ProductCode = "282ffe47-5856-4f07-a5e1-617a24a9b4a5" ?>
<?define Property_UpgradeCode = "0921ec75-fddc-46f8-bdf4-a5d697351567" ?>

<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi"
     xmlns:netfx="http://schemas.microsoft.com/wix/NetFxExtension">
	<Product Id="$(var.Property_ProductCode)"
             UpgradeCode="$(var.Property_UpgradeCode)"
             Name="!(loc.Property_ProductName)"
             Language="!(loc.Property_ProductLanguage)"
             Version="$(var.Property_ProductVersion)"
             Manufacturer="!(loc.Property_CompanyName)">

		<Package Description="!(loc.Package_Description)"
                 Comments="!(loc.Package_Comments)"
                 InstallerVersion="200"
                 Compressed="yes"
                 Platform="x64" />

		<!-- This information enables Windows Installer major upgrade functionality so users can seamlessly  -->
		<!-- install a new version of the product and have the old version automatically uninstall behind    -->
		<!-- the scenes. See the following topic in the MSDN Library for additional information:             -->
		<!-- http://msdn.microsoft.com/library/default.asp?url=/library/en-us/msi/setup/major_upgrades.asp   -->
		<Upgrade Id="$(var.Property_UpgradeCode)">
      <UpgradeVersion OnlyDetect="yes"
                      Property="OLDERVERSIONBEINGUPGRADED"
                      Minimum="1.0.0"
                      IncludeMinimum="yes"
                      Maximum="$(var.Property_ProductVersion)"
                      IncludeMaximum="no"/>
      <UpgradeVersion Minimum="$(var.Property_ProductVersion)"
                      OnlyDetect="yes"
                      Property="NEWERVERSIONDETECTED" />
    </Upgrade>

		<!-- This custom action prevents users from installing if a newer version of this product is already -->
		<!-- installed on the system. This is a part of Windows Installer major upgrade functionality.       -->
		<CustomAction Id="CA_BlockOlderVersionInstall" 
                      Error="!(loc.LaunchCondition_LaterVersion)" />

		<!-- This custom action prevents users from installing this product on unsupported operating system  -->
		<!-- versions. The conditions that are checked for operating system version are defined below.       -->
		<CustomAction Id="CA_ErrWrongWindowsVersion" 
                      Error="!(loc.LaunchCondition_WrongOSVersion)" />

        <Condition Message="This application requires .NET Framework 3.5.  Please install .NET Framework then run this installer again.">
            <![CDATA[Installed OR NETFRAMEWORK35]]>
        </Condition>
        <!-- This condition adds an item to the LaunchCondition table of the MSI to block a user from        -->
		<!-- installing this product unless they have administrative privileges on the system.               -->
		<Condition Message="!(loc.LaunchCondition_AdminPrivs)">
			<![CDATA[Privileged]]>
		</Condition>

		<!-- This is a list of directories that are used by this product as installation locations or custom -->
		<!-- action file search locations.                                                                   -->

        <Directory Id="TARGETDIR" Name="SourceDir">
            <Directory Id="WindowsFolder" Name="WINDOWS">
                <Directory Id="EhomeFolder" Name="eHome"/>
            </Directory>
            <Directory Id="ProgramFiles64Folder" Name="Program Files">
                <Directory Id="APPLICATIONROOTDIRECTORY" Name="OpenMediaLibrary">
                    <Component Id="Library.dll" Guid="6bee7ed8-c866-470b-9656-8b0320c923b5" Win64="yes" DiskId="1">
                        <File Name="Library.dll"
                              KeyPath="yes" Source="..\bin\$(var.BuildType)\Library.dll"
                              Checksum="yes" Vital="yes" Assembly=".net"/>
                    </Component>
                    <Component Id="OMLEngine.dll" Guid="fa02e91a-33fd-45e9-b189-a2cf15d3ea90" Win64="yes" DiskId="1">
                        <File Name="OMLEngine.dll"
                              KeyPath="yes" Source="..\..\OMLEngine\bin\$(var.BuildType)\OMLEngine.dll"
                              Checksum="yes" Vital="yes" Assembly=".net"/>
                    </Component>
                    <Component Id="OMLFileWatcher.dll" Guid="7ea6b674-1ad6-417a-a184-7f89aa8b1578" Win64="yes" DiskId="1">
                        <File Name="OMLFileWatcher.dll"
                              KeyPath="yes" Source="..\..\OMLFileWatcher\bin\$(var.BuildType)\OMLFileWatcher.dll"
                              Checksum="yes" Vital="yes" Assembly=".net"/>
                    </Component>
                    <Component Id="OMLTranscoder.dll" Guid="af99c403-9114-4809-a9af-ba8038d47ea7" Win64="yes" DiskId="1">
                        <File Name="OMLTranscoder.dll"
                              KeyPath="yes" Source="..\..\OMLTranscoder\bin\$(var.BuildType)\OMLTranscoder.dll"
                              Checksum="yes" Vital="yes" Assembly=".net"/>
                    </Component>
                    <Component Id="Registration.xml" Guid="68b08279-69c0-42fb-b087-30a20ee12608" Win64="yes" DiskId="1">
                        <File Name="Registration.xml"
                              Source="..\Registration.xml" Checksum="no" />
                    </Component>
                    <Component Id="Application.png" Guid="34c83bcd-a522-4103-8bac-ad159113d313" Win64="yes" DiskId="1">
                        <File Name="Application.png"
                              Source="..\Images\Application.png" Checksum="no" />
                      <File Name="Application2.png"
                            Source="..\Images\Application2.png" Checksum="no" />
                      <File Name="Settings.png"
                            Source="..\Images\Settings.png" Checksum="no" />
                    </Component>
                    
                    <!--<Component Id="ComponentFactory.Krypton.Toolkit.DLL" Guid="ACDECE2C-B066-415e-AD42-0B63D341300F" Win64="yes" DiskId="1">
                        <File Name="ComponentFactory.Krypton.Toolkit.DLL"
                              Source="..\..\..\OMLDatabaseEditor\bin\$(var.BuildType)\ComponentFactory.Krypton.Toolkit.DLL" Checksum="no" />
                    </Component>-->
                  <Component Id="DevExpress.Data.v8.2.dll" Guid="5268f9d7-2529-4af0-b5fb-6b94079a7f74" Win64="yes" DiskId="1">
                    <File Name="DevExpress.Data.v8.2.dll"
                          Source="..\..\..\OMLDatabaseEditor\bin\$(var.BuildType)\DevExpress.Data.v8.2.dll" Checksum="no" />
                  </Component>
                  
                  <Component Id="DevExpress.Utils.v8.2.dll" Guid="419c9895-3e28-442c-af94-d77f9e4487b4" Win64="yes" DiskId="1">
                    <File Name="DevExpress.Utils.v8.2.dll"
                          Source="..\..\..\OMLDatabaseEditor\bin\$(var.BuildType)\DevExpress.Utils.v8.2.dll" Checksum="no" />
                  </Component>

                  <Component Id="DevExpress.XtraEditors.v8.2.dll" Guid="cd530611-c23a-4a31-aa6e-ac8926845707" Win64="yes" DiskId="1">
                    <File Name="DevExpress.XtraEditors.v8.2.dll"
                          Source="..\..\..\OMLDatabaseEditor\bin\$(var.BuildType)\DevExpress.XtraEditors.v8.2.dll" Checksum="no" />
                  </Component>

                  <Component Id="DevExpress.XtraNavBar.v8.2.dll" Guid="cd530611-c23a-4a31-aa6f-ac8926845707" Win64="yes" DiskId="1">
                    <File Name="DevExpress.XtraNavBar.v8.2.dll"
                          Source="..\..\..\OMLDatabaseEditor\bin\$(var.BuildType)\DevExpress.XtraNavBar.v8.2.dll" Checksum="no" />
                  </Component>

                  <Component Id="DevExpress.Data.v8.2.xml" Guid="25af85cb-dc9d-46df-b022-f8a3df4f71fb" Win64="yes" DiskId="1">
                    <File Name="DevExpress.Data.v8.2.xml"
                          Source="..\..\..\OMLDatabaseEditor\bin\$(var.BuildType)\DevExpress.Data.v8.2.xml" Checksum="no" />
                  </Component>
                  
                  <Component Id="DevExpress.Utils.v8.2.xml" Guid="ac15ad59-c236-4a0b-9cb9-a009684582b7" Win64="yes" DiskId="1">
                    <File Name="DevExpress.Utils.v8.2.xml"
                          Source="..\..\..\OMLDatabaseEditor\bin\$(var.BuildType)\DevExpress.Utils.v8.2.xml" Checksum="no" />
                  </Component>
                  
                  <Component Id="DevExpress.XtraEditors.v8.2.xml" Guid="365ba1f3-7823-4ff7-ac1c-cb040d2b852e" Win64="yes" DiskId="1">
                    <File Name="DevExpress.XtraEditors.v8.2.xml"
                          Source="..\..\..\OMLDatabaseEditor\bin\$(var.BuildType)\DevExpress.XtraEditors.v8.2.xml" Checksum="no" />
                  </Component>

                  <Component Id="DevExpress.XtraNavBar.v8.2.xml" Guid="365ba1f3-7823-4ff8-ac1c-cb040d2b852e" Win64="yes" DiskId="1">
                    <File Name="DevExpress.XtraNavBar.v8.2.xml"
                          Source="..\..\..\OMLDatabaseEditor\bin\$(var.BuildType)\DevExpress.XtraNavBar.v8.2.xml" Checksum="no" />
                  </Component>

                    <Component Id="OMLDatabaseEditor.exe" Guid="4226fe89-8797-44ed-b463-6fda1be5c918" Win64="yes" DiskId="1">
                        <File Name="OMLDatabaseEditor.exe"
                              Source="..\..\OMLDatabaseEditor\bin\$(var.BuildType)\OMLDatabaseEditor.exe" Checksum="no" />
                    </Component>
                    <Component Id="OMLImporter.exe" Guid="5405ac5c-69ba-49c0-8854-bb766ffe44bb" Win64="yes" DiskId="1">
                        <File Name="OMLImporter.exe"
                              Source="..\..\OMLImporter\bin\$(var.BuildType)\OMLImporter.exe" Checksum="no" />
                    </Component>
                    <Component Id="MEncoder.exe" Guid="1a3587c9-7219-4298-9351-c1ed480e430f" Win64="yes" DiskId="1">
                        <File Name="MEncoder.exe"
                              Source="..\..\OMLTranscoder\mencoder-1.0rc2-4.2.1.exe" Checksum="no" />
                    </Component>

					<Component Id="MediaInfo.dll" Guid="BCDD1285-37EA-4086-838A-82BE908F074F" Win64="yes" DiskId="1">
						<File Name="MediaInfo.dll"
                              Source="..\..\OMLEngine\MediaInfox64.dll" Checksum="no" />
					</Component>
					
                  <Component Id="Maximizer.exe" Guid="e94299e1-62cd-4068-8861-052c8c7bec6c" Win64="yes" DiskId="1">
                    <File Name="Maximizer.exe"
                          Source="..\..\Maximizer\bin\$(var.BuildType)\Maximizer.exe" Checksum="no" />
                  </Component>

				  <Component Id="TranscoderTester.exe" Guid="2F7D11B3-70BD-4f2d-9EC1-730D28042BBF" DiskId="1" Win64="yes">
					<File Name="TranscoderTester.exe"
						  Source="..\..\TranscoderTester\bin\$(var.BuildType)\TranscoderTester.exe" Checksum="no" />
				  </Component>
                  
                  <Component Id="OMLEngineService.exe" Guid="12988468-3dcc-496a-b0b3-6982ffde25b9" DiskId="1" Win64="yes">
                    <File Name="OMLEngineService.exe"
                          Source="..\..\OMLEngineService\bin\$(var.BuildType)\OMLEngineService.exe" Checksum="yes"/>
                    <File Name="OMLEngineService.exe.config"
                          Source="..\..\OMLEngineService\bin\$(var.BuildType)\OMLEngineService.exe.config" Checksum="no"/>
                    <ServiceInstall Id="OMLEngineService" Name="OMLEngineService" DisplayName="OMLEngineService"
                                    Type="ownProcess" Interactive="no" Start="demand" Vital="yes"
                                    ErrorControl="normal"/>
                    <!--<ServiceControl Id="OMLEngineServiceControl" Name="OMLEngineService"
                                        Start="install" Stop="both" Wait="yes" Remove="uninstall"/>-->
                  </Component>                  
                  
                  <Component Id="OMLFWService.exe" Guid="8f57190c-0489-40b4-9c46-5e9b09ec0dec" DiskId="1" Win64="yes">
                    <File Name="OMLFWService.exe"
                          Source="..\..\OMLFWService\bin\$(var.BuildType)\OMLFWService.exe" Checksum="yes"/>
                    <ServiceInstall Id="OMLFWService" Name="OMLFWService" DisplayName="OMLFWService"
                                    Type="ownProcess" Interactive="no" Start="demand" Vital="yes"
                                    ErrorControl="normal"/>
                    <!--<ServiceControl Id="OMLFWServiceControl" Name="OMLFWService"
                                        Start="install" Stop="both" Wait="yes" Remove="uninstall"/>-->
                  </Component>
                  <Directory Id ="HELPDIRECTORY" Name="Help">
                    <Component Id="Open_Media_Library_User_Manual.pdf" Guid="699C7762-E52E-4761-81C3-52B01231A2D2" Win64="yes" DiskId="1">
                      <File Name="Open_Media_Library_User_Manual.pdf" KeyPath="no"
                            Source="..\..\Documentation\Open_Media_Library_User_Manual.pdf" Checksum="no" Vital="yes"/>
                    </Component>
                  </Directory>
                  <Directory Id="PLUGINSDIRECTORY" Name="Plugins">
                        <Component Id="DVDProfilerPlugin.dll" Guid="b7f12ef4-e500-4d0e-bfbe-d77eae64176c" Win64="yes" DiskId="1">
                            <File Name="DVDProfilerPlugin.dll"
                                  KeyPath="yes" Source="..\..\DVDProfilerPlugin\bin\$(var.BuildType)\DVDProfilerPlugin.dll"
                                  Checksum="yes" Vital="yes"/>
                        </Component>
                        <Component Id="DVRMSPlugin.dll" Guid="ec74a168-53ae-4bef-a72d-3ff093bb8b0f" Win64="yes" DiskId="1">
                            <File Name="DVRMSPlugin.dll"
                                  KeyPath="yes" Source="..\..\DVRMSPlugin\bin\$(var.BuildType)\DVRMSPlugin.dll"
                                  Checksum="yes" Vital="yes"/>
                        </Component>
                        <Component Id="MovieCollectorz.dll" Guid="b3a7750c-5474-4bdf-9926-64e13ed92a97" Win64="yes" DiskId="1">
                            <File Name="MovieCollectorz.dll"
                                  KeyPath="yes" Source="..\..\MovieCollectorz\bin\$(var.BuildType)\MovieCollectorz.dll"
                                  Checksum="yes" Vital="yes"/>
                        </Component>
                        <Component Id="MyMoviesPlugin.dll" Guid="4102ad78-c010-4367-8454-7317713ccfe6" Win64="yes" DiskId="1">
                            <File Name="MyMoviesPlugin.dll"
                                  KeyPath="yes" Source="..\..\MyMoviesPlugin\bin\$(var.BuildType)\MyMoviesPlugin.dll"
                                  Checksum="yes" Vital="yes"/>
                        </Component>
                        <Component Id="MyMoviesToOML.xsl" Guid="a449cc9c-7e60-49bf-982b-ce389fbe7d40" Win64="yes" DiskId="1">
                            <File Name="MyMoviesToOML.xsl"
                                  KeyPath="yes" Source="..\..\MyMoviesPlugin\MyMoviesToOML.xsl"
                                  Vital="yes"/>
                        </Component>
                        <Component Id="VMCDVDLibraryPlugin.dll" Guid="d8028d8c-a048-46b2-9c27-c64f07c8ab8d" Win64="yes" DiskId="1">
                            <File Name="VMCDVDLibraryPlugin.dll"
                                  KeyPath="yes" Source="..\..\VMCDVDLibraryPlugin\bin\$(var.BuildType)\VMCDVDLibraryPlugin.dll"
                                  Checksum="yes" Vital="yes"/>
                        </Component>
                        <Component Id="OMLXMLImporter.dll" Guid="5be2002c-ef0d-4358-93ef-5c495492ab0d" Win64="yes" DiskId="1">
                            <File Name="OMLXMLImporter.dll"
                                  KeyPath="yes" Source="..\..\OMLXMLImporter\bin\$(var.BuildType)\OMLXMLImporter.dll"
                                  Checksum="yes" Vital="yes"/>
                        </Component>
                        <Component Id="AmazonMetadata.dll" Guid="6129eb0a-3c81-4a10-bc42-6d2b5849d0cd" Win64="yes" DiskId="1">
                            <File Name="AmazonMetadata.dll"
                                  KeyPath="yes" Source="..\..\AmazonMetadata\bin\$(var.BuildType)\AmazonMetadata.dll"
                                  Checksum="yes" Vital="yes"/>
                        </Component>
                      <Component Id="TheMovieDbMetadata.dll" Guid="46534b9a-16b6-4c74-ab87-03b89be3b160" Win64="yes" DiskId="1">
                        <File Name="TheMovieDbMetadata.dll"
                              KeyPath="yes" Source="..\..\TheMovieDbMetadata\bin\$(var.BuildType)\TheMovieDbMetadata.dll"
                              Checksum="yes" Vital="yes"/>
                      </Component>
                    <Component Id="NetFlixMetadata.dll" Guid="73213057-08D2-4262-A8F2-4A4FC7BE6F62" Win64="yes" DiskId="1">
                      <File Name="NetFlixMetadata.dll"
                            KeyPath="yes" Source="..\..\NetFlixMetadata\bin\$(var.BuildType)\NetFlixMetadata.dll"
                            Checksum="yes" Vital="yes"/>
                    </Component>
                      <Component Id="DVDProfilerMetaData.dll" Guid="830DF3C8-507C-49f2-8153-CBE2949945A5" Win64="yes" DiskId="1">
                        <File Name="DVDProfilerMetaData.dll"
                              KeyPath="yes" Source="..\..\DVDProfilerMetaData\bin\$(var.BuildType)\DVDProfilerMetaData.dll"
                              Checksum="yes" Vital="yes"/>
                      </Component>
                        <Component Id="OMLSDK.dll" Guid="26097a63-fc55-41d2-a8d5-432809de99fc" Win64="yes" DiskId="1">
                            <File Name="OMLSDK.dll"
                                  KeyPath="yes" Source="..\..\OMLSDK\bin\$(var.BuildType)\OMLSDK.dll"
                                  Checksum="yes" Vital="yes" Assembly=".net"/>
                        </Component>
                        <!--<Component Id="OMLGetDVDInfo.dll" Guid="d69b2e44-0e10-4081-9628-4db9a9ba7c0c" Win64="yes" DiskId="1">
                            <File Name="OMLGetDVDInfo.dll"
                                  KeyPath="yes" Source="..\..\OMLGetDVDInfo\bin\$(var.BuildType)\OMLGetDVDInfo.dll"
                                  Checksum="yes" Vital="yes" Assembly=".net"/>
                        </Component>-->
                    </Directory>
                </Directory>
            </Directory>
            <Directory Id="ProgramMenuFolder">
                <Directory Id="ApplicationProgramsFolder" Name="OpenMediaLibrary">
                    <Component Id="DatabaseEditorShortcut" Win64="yes" Guid="">
                        <Shortcut Id="DatabaseEditorStartMenuShortcut"
                                  Name="OML Database Editor"
                                  Description="My Application Description"
                                  Target="[APPLICATIONROOTDIRECTORY]OMLDatabaseEditor.exe"
                                  Icon="icon.ico"
                                  WorkingDirectory="APPLICATIONROOTDIRECTORY"/>
                        <RemoveFolder Id="ApplicationProgramsFolder" On="uninstall"/>
                        <RegistryValue Root="HKCU" Key="Software\OpenMediaLibrary\DatabaseEditorShortcut" Name="installed" Type="integer" Value="1" KeyPath="yes"/>
                    </Component>
                    <Component Id="ImporterShortcut" Win64="yes" Guid="">
                        <Shortcut Id="ImporterStartMenuShortcut"
                                  Name="Commandline Database Editor"
                                  Description="My Application Description"
                                  Target="[APPLICATIONROOTDIRECTORY]OMLImporter.exe"
                                  WorkingDirectory="APPLICATIONROOTDIRECTORY"/>
                        <RegistryValue Root="HKCU" Key="Software\OpenMediaLibrary\ImporterShortcut" Name="installed" Type="integer" Value="1" KeyPath="yes"/>
                    </Component>
                  <Component Id="UserManualShortcut" Guid="">
                    <Shortcut Id="UserManualStartMenuShortcut"
                              Name="User Manual"
                              Description="OML User Manual"
                              Target="[HELPDIRECTORY]Open_Media_Library_User_Manual.pdf"
                              WorkingDirectory="HELPDIRECTORY"/>
                    <RegistryValue Root="HKCU" Key="Software\OpenMediaLibrary\UserManualShortcut" Name="installed" Type="integer" Value="1" KeyPath="yes"/>
                  </Component>
                </Directory>
            </Directory>
        </Directory>

    <DirectoryRef Id="TARGETDIR">
      <Component Id="registry" Guid="FDDE2AF7-995E-4b84-B8B7-2E150E7C7101" DiskId="1" KeyPath="yes">
        <RegistryKey Id="registry0" Root="HKLM" Key="Software\Microsoft\Windows\CurrentVersion\Media Center\Start Menu\Applications\{ad208fce-2431-47d6-abed-1974a2a0555f}" Action="create">
          <RegistryValue Id="reg1" Type="string" Name="Title" Value="Media Library" Action="write"/>
          <RegistryValue Id="reg2" Type="string" Name="Category" Value="OML\Media Library" Action="write"/>
          <RegistryValue Id="reg3" Type="string" Name="OnStartMenu" Value="True" Action="write"/>
          <RegistryValue Id="reg4" Type="integer" Name="TimeStamp" Value="214505905" Action="write"/>
        </RegistryKey>
        <RegistryKey Id="registry1" Root="HKLM" Key="Software\Microsoft\Windows\CurrentVersion\Media Center\Extensibility\Categories\OML\Media Library\{7533724d-c7cb-4ac2-8aee-1b0b91add393}" Action="create">
          <RegistryValue Id="reg5" Type="integer" Name="TimeStamp" Value="214505905" Action="write"/>
        </RegistryKey>
        <RegistryKey Id="registry2" Root="HKLM" Key="Software\Microsoft\Windows\CurrentVersion\Media Center\Extensibility\Categories\OML\Media Library\{543d0438-b10d-43d8-a20d-f0c96db4e6bd}" Action="create">
          <RegistryValue Id="reg6" Type="integer" Name="TimeStamp" Value="214505906" Action="write"/>
        </RegistryKey>
        <RemoveRegistryKey Action="removeOnInstall" Id="deleteOldKey" Root="HKCU" Key="Software\Microsoft\Windows\CurrentVersion\Media Center\Extensibility\Categories\Services\Movies\{543d0438-b10d-43d8-a20d-f0c96db4e6bd}" />
      </Component>
      <Component Id="registryFWS" Guid="1A746A98-A8D4-4e5e-B41F-5E6D6B8B5DFD" DiskId="1">
        <RegistryKey Id="registryFWS0" Root="HKCU" Key="Software\OpenMediaLibrary" Action="createAndRemoveOnUninstall">
          <RegistryValue Id="registryFWS1" Type="integer" Name="logging" Value="1"/>
          <RegistryValue Id="registryFWS2" Type="multiString" Name="Watches" Value="c:\\users\\public\\recorded tv;*.*" />
        </RegistryKey>
      </Component>
    </DirectoryRef>
    
        <!-- This is a list of all components installed as a part of this product. A component is the        -->
		<!-- smallest atomic unit of installation in Windows Installer. Each component must have a unique    -->
		<!-- GUID. In general, it is recommended that each file be installed by a separate component in      -->

		<!-- order to avoid reference counting problems and make future servicing of this product easier.    -->
		<!-- Each component is listed as a child of the DirectoryRef that represents the directory that      -->
		<!-- the file it contains will install to.                                                           -->

        <Icon Id="icon.ico" SourceFile="..\Resources\Application.ico"/>
        <!-- This is a list of features that are installed as a part of this product. In this case, there is -->
		<!-- only one feature. Each feature contains a list of components that it will install. Features can -->
		<!-- can be displayed and allow user selection in setup UI if desired.                               -->
		<Feature Id="APPLICATIONROOTFEATURE" Title="Open Media Library" Level="1">
            <ComponentRef Id="Library.dll" />
            <ComponentRef Id="OMLEngine.dll" />
            <ComponentRef Id="OMLFileWatcher.dll"/>
            <ComponentRef Id="OMLTranscoder.dll"/>
            <ComponentRef Id="Registration.xml" />
            <ComponentRef Id="Application.png" />
            <ComponentRef Id="OMLEngineService.exe"/>
            <!--<ComponentRef Id="OMLEngineService.exe.config"/>-->
            <ComponentRef Id="OMLFWService.exe"/>

            <!-- Plugins -->
            <ComponentRef Id="DVDProfilerPlugin.dll" />
            <ComponentRef Id="DVRMSPlugin.dll" />
            <ComponentRef Id="MovieCollectorz.dll" />
            <ComponentRef Id="MyMoviesPlugin.dll" />
            <ComponentRef Id="MyMoviesToOML.xsl" />
            <ComponentRef Id="OMLSDK.dll" />
            <!--<ComponentRef Id="OMLGetDVDInfo.dll" />-->
            <ComponentRef Id="VMCDVDLibraryPlugin.dll" />
            <ComponentRef Id="OMLXMLImporter.dll" />
            <ComponentRef Id="AmazonMetadata.dll" />
            <ComponentRef Id="TheMovieDbMetadata.dll" />
            <ComponentRef Id="NetFlixMetadata.dll"/>
            <ComponentRef Id="DVDProfilerMetaData.dll"/>

            <!-- Windows programs -->
            <!--<ComponentRef Id="ComponentFactory.Krypton.Toolkit.DLL"/>-->
            <ComponentRef Id="DevExpress.Data.v8.2.dll"/>
            <ComponentRef Id="DevExpress.Utils.v8.2.dll"/>
            <ComponentRef Id="DevExpress.XtraEditors.v8.2.dll"/>
            <ComponentRef Id="DevExpress.XtraNavBar.v8.2.dll"/>
            <ComponentRef Id="DevExpress.Data.v8.2.xml"/>
            <ComponentRef Id="DevExpress.Utils.v8.2.xml"/>
            <ComponentRef Id="DevExpress.XtraEditors.v8.2.xml"/>
            <ComponentRef Id="DevExpress.XtraNavBar.v8.2.xml"/>
            <ComponentRef Id="OMLDatabaseEditor.exe" />
            <ComponentRef Id="OMLImporter.exe" />
            <ComponentRef Id="MEncoder.exe"/>
			<ComponentRef Id="MediaInfo.dll"/>
			<ComponentRef Id="TranscoderTester.exe"/>
            <ComponentRef Id="Maximizer.exe"/>
      <ComponentRef Id="Open_Media_Library_User_Manual.pdf"/>

      <!-- Start Menu Shortcuts -->
            <ComponentRef Id="DatabaseEditorShortcut" />
            <ComponentRef Id="ImporterShortcut" />
      <ComponentRef Id="UserManualShortcut" />

      <!-- Registry Keys -->
            <ComponentRef Id="registry"/>
            <ComponentRef Id="registryFWS"/>
        </Feature>

		<!-- The media table defines the location that the MSI will look to find source files during         -->
		<!-- installation or repair scenarios. In this case, the source files are in a cab file that will be -->
		<!-- embedded directly into the MSI at build time.                                                   -->
		<Media Id="1" Cabinet="OpenMediaLibrary.cab" EmbedCab="yes" />

		<!-- These custom actions are used to register the application with Media Center using the utility   -->
		<!-- RegisterMceApp.exe that is installed as a part of the Windows Media Center feature. Each custom -->
		<!-- action is defined as a pair in order to leverage the WiX QtExec custom action to suppress the   -->
		<!-- pop-up UI that would ordinarily appear when running RegisterMceApp.exe. Registering a Windows   -->
		<!-- Media Center application will fail if it is already registered, so this setup will first        -->
		<!-- unregister the application and then attempt to re-register it. This setup ignores the return    -->
		<!-- code from the unregistration custom action but checks the return code of the registration       -->
		<!-- action. If registration fails, setup will fail and roll back. These custom actions use the      -->
		<!-- REGISTERMCEAPP property that is defined below in order to find the exact location of the file   -->
		<!-- RegisterMceApp.exe on the system.                                                               -->
		<CustomAction Id="CA_RegisterMceApp_Unregister_Install_Cmd" Property="CA_RegisterMceApp_Unregister_Install" Value="&quot;[REGISTERMCEAPP]&quot; /u /allusers &quot;[#Registration.xml]&quot;"/>
		<CustomAction Id="CA_RegisterMceApp_Unregister_Uninstall_Cmd" Property="CA_RegisterMceApp_Unregister_Uninstall" Value="&quot;[REGISTERMCEAPP]&quot; /u /allusers &quot;[#Registration.xml]&quot;"/>
		<CustomAction Id="CA_RegisterMceApp_Register_Cmd" Property="CA_RegisterMceApp_Register" Value="&quot;[REGISTERMCEAPP]&quot; /allusers &quot;[#Registration.xml]&quot;"/>
		<CustomAction Id="CA_RegisterMceApp_Rollback_Cmd" Property="CA_RegisterMceApp_Rollback" Value="&quot;[REGISTERMCEAPP]&quot; /u /allusers &quot;[#Registration.xml]&quot;"/>

		<CustomAction Id="CA_RegisterMceApp_Unregister_Install" BinaryKey="WixCA" DllEntry="CAQuietExec" Execute="deferred" Return="ignore" Impersonate="no"/>
		<CustomAction Id="CA_RegisterMceApp_Unregister_Uninstall" BinaryKey="WixCA" DllEntry="CAQuietExec" Execute="deferred" Return="ignore" Impersonate="no"/>
		<CustomAction Id="CA_RegisterMceApp_Register" BinaryKey="WixCA" DllEntry="CAQuietExec" Execute="deferred" Return="check" Impersonate="no"/>
		<CustomAction Id="CA_RegisterMceApp_Rollback" BinaryKey="WixCA" DllEntry="CAQuietExec" Execute="rollback" Return="ignore" Impersonate="no"/>

    <CustomAction Id="ActivateNetTcpPortSharing"
                  Directory="TARGETDIR"
                  ExeCommand="sc.exe config NetTcpPortSharing start= demand"
                  Execute="deferred"
                  Impersonate="no"
                  Return="ignore" />
    <!--
    <CustomAction Id="ActivateNetTcpPortSharing"
                  Directory="TARGETDIR"
                  ExeCommand="sc.exe config NetTcpPortSharing start= demand"
                  Execute="deferred"
                  Return="ignore"
                  Impersonate="no"/>
-->
    <!-- The InstallExecuteSequence table describes the order that actions will be executed during       -->
		<!-- installation, repair and uninstall of this product.                                             -->
		<InstallExecuteSequence>
			<Custom Action="CA_BlockOlderVersionInstall" After="FindRelatedProducts">
				<![CDATA[NEWERVERSIONDETECTED]]>
			</Custom>
			<RemoveExistingProducts After="InstallFinalize" />
			<LaunchConditions After="AppSearch"/>

			<!-- This custom action searches for Windows version 6.0, the Windows Media Center Ident registry  -->
			<!-- value 5.0 and the presence of the file %windir%\eHome\RegisterMceApp.exe. If all of these     -->
			<!-- conditions are met/, the system is a Windows Vista Home Premium or Ultimate Edition operating  -->
			<!-- system and the product will be allowed to install.                                            -->
			<Custom Action="CA_ErrWrongWindowsVersion" Before="CostInitialize"><![CDATA[(NOT VersionNT >= 600 OR NOT REGISTERMCEAPP) AND NOT Installed]]></Custom>

			<Custom Action="CA_RegisterMceApp_Unregister_Install_Cmd" After="CostFinalize">
				<![CDATA[NOT REMOVE]]>
			</Custom>
			<Custom Action="CA_RegisterMceApp_Unregister_Uninstall_Cmd" After="CA_RegisterMceApp_Unregister_Install_Cmd">
				<![CDATA[REMOVE AND ($Registration.xml = 2)]]>
			</Custom>
			<Custom Action="CA_RegisterMceApp_Register_Cmd" After="CA_RegisterMceApp_Unregister_Uninstall_Cmd">
				<![CDATA[NOT REMOVE]]>
			</Custom>
			<Custom Action="CA_RegisterMceApp_Rollback_Cmd" After="CA_RegisterMceApp_Register_Cmd">
				<![CDATA[NOT REMOVE]]>
			</Custom>

			<!-- This unregistration custom action must occur before files are removed during uninstall of the -->
			<!-- product because the custom action requires the registration XML file in order to run          -->
			<!-- correctly. It is conditioned to only run during uninstall using the REMOVE condition.         -->
			<Custom Action="CA_RegisterMceApp_Unregister_Uninstall" Before="RemoveFiles">
				<![CDATA[REMOVE AND ($Registration.xml = 2)]]>
			</Custom>

			<!-- This sequence of actions is important. In order to allow the roll back custom action to run   -->
			<!-- at the correct time in case the setup fails, it must be scheduled before the other actions    -->
			<!-- because Windows Installer pushes each action onto a stack and then pops them off of the stack -->
			<!-- in case of any failure in order to accomplish the roll back.                                  -->
			<Custom Action="CA_RegisterMceApp_Rollback" After="InstallFiles">
				<![CDATA[NOT REMOVE]]>
			</Custom>
			<Custom Action="CA_RegisterMceApp_Unregister_Install" After="CA_RegisterMceApp_Rollback">
				<![CDATA[NOT REMOVE]]>
			</Custom>
			<Custom Action="CA_RegisterMceApp_Register" After="CA_RegisterMceApp_Unregister_Install">
				<![CDATA[NOT REMOVE]]>
			</Custom>
            <Custom Action="ActivateNetTcpPortSharing" After="InstallInitialize">Not Installed</Custom>
            <!--<ScheduleReboot After="InstallFinalize"/>-->
        </InstallExecuteSequence>

		<!-- The InstallUISequence table describes the order that actions will be executed when the user     -->
		<!-- runs setup in full UI mode. Some actions must be scheduled in the UI and the execute sequence   -->
		<!-- tables to ensure that they will run regardless of whether the user runs setup in full UI mode   -->
		<!-- or in reduced UI or silent modes.                                                               -->
		<InstallUISequence>
			<Custom Action="CA_BlockOlderVersionInstall" After="FindRelatedProducts">
				<![CDATA[NEWERVERSIONDETECTED]]>
			</Custom>
			<Custom Action="CA_ErrWrongWindowsVersion" Before="CostInitialize"><![CDATA[(NOT VersionNT >= 600 OR NOT REGISTERMCEAPP) AND NOT Installed]]></Custom>
		</InstallUISequence>

        <!-- This sets the icon used for the Add/Remove Programs screen -->
        <Property Id="ARPPRODUCTICON" Value="icon.ico" />

        <!-- These properties define links that will appear in the Add/Remove Programs control panel when    -->
		<!-- this product is installed on the system.                                                        -->
		<Property Id="ARPHELPLINK" Value="!(loc.Property_ArpHelpLink)" />
		<Property Id="ARPURLINFOABOUT" Value="!(loc.Property_ArpUrlInfoAbout)" />

		<!-- This property defines the ALLUSERS property to be 1, which indicates that this product will be  -->
		<!-- installed per-machine instead of per-user.                                                      -->
		<Property Id="ALLUSERS">
			<![CDATA[1]]>
		</Property>

		<!-- This property uses an AppSearch to attempt to locate the file %windir\eHome\ehShell.exe  on the -->
		<!-- system. If it is found, the property is set to the fully qualified path to this file, and this  -->
		<!-- path is used to create a desktop shortcut to launch the application in Windows Media Center.    -->
		<Property Id="EHSHELLEXE" Secure="yes">
			<DirectorySearch Id="EhomeDirectory" Path="[WindowsFolder]\ehome">
				<FileSearch Id="EhShellExe" Name="ehShell.exe" MinVersion="6.0.0.0" />
			</DirectorySearch>
		</Property>
		<!-- This property uses an AppSearch to attempt to locate the file %windir\eHome\RegisterMceApp.exe  -->
		<!-- on the system. If it is found, the property is set to the fully qualified path to this file,    -->
		<!-- and this path is used to call RegisterMceApp.exe in several custom actions listed above to      -->
		<!-- register this application with Windows Media Center.                                            -->
		<Property Id="REGISTERMCEAPP" Secure="yes">
			<DirectorySearch Id="EhomeDirectory2" Path="[WindowsFolder]\ehome">
				<FileSearch Id="RegisterMceAppExe" Name="RegisterMceApp.exe" />
			</DirectorySearch>
		</Property>

		<!-- This property is used as the default installation directory, and the user can change this path  -->
		<!-- during setup. The Id must be set to WIXUI_INSTALLDIR and the value must match the directory Id  -->
		<!-- defined above that represents the root installation directory.                                  -->
		<Property Id="WIXUI_INSTALLDIR" Value="APPLICATIONROOTDIRECTORY"/>

		<!-- This UIRef element specifies what WiXUI dialog set to use for the setup UI. This package uses   -->
		<!-- the WixUI_InstallDir dialog set, which provides a welcome page, a license agreement page, a     -->
		<!-- page to allow changing the installation path, an installation confirmation page, a progress     -->
		<!-- page and a completion page. Other dialog sets are available in the WiX toolset and are          -->
		<!-- described in more detail in the WiX documentation.                                              -->
        <UI>
            <UIRef Id="WixUI_Minimal" />
            <Publish Dialog="ExitDialog"
                     Control="Finish"
                     Event="DoAction"
                     Value="LaunchApplication">WIXUI_EXITDIALOGOPTIONALCHECKBOX = 1 and NOT Installed</Publish>
        </UI>
        <Property Id="WIXUI_EXITDIALOGOPTIONALCHECKBOXEXT" Value="Launch My Application Name" />
        <Property Id="WixShellExecTarget" Value="[#OMLDatabaseEditor.exe]" />
        <CustomAction Id="LaunchApplication"
                      BinaryKey="WixCA"
                      DllEntry="WixShellExec"
                      Impersonate="yes" />

        <!-- In WiX v3.0, this variable is used to override the default license agreement text that is       -->
		<!-- included in the WixUIExtension with a custom file.                                              -->
		<WixVariable Id="WixUILicenseRtf" Value="License.rtf" />

        <PropertyRef Id="NETFRAMEWORK35"/>
    </Product>
</Wix>

