<?xml version="1.0" encoding="UTF-8"?>

<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi"
     xmlns:netfx="http://schemas.microsoft.com/wix/NetFxExtension"
     xmlns:sql="http://schemas.microsoft.com/wix/SqlExtension"
     xmlns:util="http://schemas.microsoft.com/wix/UtilExtension">

  <Fragment>

    <!-- Set the status text to be displayed during each custom action as its run -->
    <UI>
      <ProgressText Action="ReserveTrailersUrlAction">Reserving Url for Trailers Proxy Server</ProgressText>
      <ProgressText Action="ActivateNetTcpPortSharingAction">Activating NetTcpPortSharing for Transcoding Services</ProgressText>
      <ProgressText Action="StartOMLEngineServiceAction">Starting the OMLEngine Service</ProgressText>
      <ProgressText Action="ScanNetworkForSqlServersAction">Scanning your network for instances of Microsoft Sql Server</ProgressText>
    </UI>

    <!-- OML Custom Managed Actions -->
    <CustomAction Id="ReserveTrailersUrlAction"
                  BinaryKey="OMLCALib"
                  DllEntry="ReserveTrailersUrl"
                  Execute="deferred"
                  Impersonate="no"
                  Return="check" />

    <CustomAction Id="StartOMLEngineServiceAction"
                BinaryKey="OMLCALib"
                DllEntry="StartOMLEngineService"
                Return="ignore" />

    <CustomAction Id="ActivateNetTcpPortSharingAction"
                BinaryKey="OMLCALib"
                DllEntry="ActivateNetTcpPortSharing"
                Execute="deferred"
                Return="check" />

    <CustomAction Id="ScanNetworkForSqlServersAction"
                  BinaryKey="OMLCALib"
                  DllEntry="ScanNetworkForSqlServers"
                  Execute="deferred"
                  Return="check" />

    <!-- The binary to include that contains managed custom actions -->
    <Binary Id="OMLCALib"
            SourceFile="..\..\OMLCustomWiXAction\bin\$(var.BuildType)\OMLWiXActionsCAsPackage.dll" />

    <!-- Run these custom actions -->
    <InstallExecuteSequence>
      <Custom Action="ScanNetworkForSqlServersAction" Before="ActivateNetTcpPortSharingAction">
        <![CDATA[NOT REMOVE]]>
      </Custom>
      <Custom Action="ActivateNetTcpPortSharingAction" Before="ReserveTrailersUrlAction">
        <![CDATA[NOT REMOVE]]>
      </Custom>
      <Custom Action='ReserveTrailersUrlAction' Before='InstallFinalize'>
        <![CDATA[NOT REMOVE]]>
      </Custom>
      <Custom Action='StartOMLEngineServiceAction' After='InstallFinalize'>
        <![CDATA[NOT REMOVE]]>
      </Custom>
      <Custom Action='LaunchApplication' After='StartOMLEngineServiceAction'>
        <![CDATA[NOT REMOVE]]>
      </Custom>
    </InstallExecuteSequence>

    <Property Id="WixShellExecTarget" Value="[#PostInstallerWizard.exe]" />
    <CustomAction Id="LaunchApplication"
                  BinaryKey="WixCA"
                  DllEntry="WixShellExec"
                  Impersonate="yes"/>

  </Fragment>
</Wix>